!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t["@jsmini/util-tools"]={})}(this,function(t){"use strict";function e(t){var e=!1;return function(){return e?void 0:(e=!0,t.apply(this,arguments))}}function o(t,e){void 0===e&&(e=500);var o=null;return function(){var r=this,n=arguments;o&&clearTimeout(o),o=setTimeout(function(){t.apply(r,n)},e)}}function r(t,e){void 0===e&&(e=500);var o,r,n=arguments;return function i(){var s=this,a=Date.now();r||(r=a),o&&clearTimeout(o),a-r>=e?(t.apply(s,n),r=a):o=setTimeout(function(){i.apply(s,n)},50)}}function n(t,e,o){void 0===o&&(o="id");var r=Object.create(null);t.forEach(function(t){r[t[o]]=t});var n=[];return t.forEach(function(t){var o=r[t[e]];if(o){(o.children||(o.children=[])).push(t)}else n.push(t)}),n}function i(t,e,o){void 0===e&&(e="name"),void 0===o&&(o="value");var r=[];for(var n in t){var i=Object.create(null);i[e]=n,i[o]=t[n],r.push(i)}return r}function s(t,e,o){void 0===e&&(e="name"),void 0===o&&(o="value");var r=Object.create(null);return t.forEach(function(t){r[t[e]]=t[o]}),r}var a=function(){return a=Object.assign||function(t){for(var e,o=1,r=arguments.length;o<r;o++){e=arguments[o];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},a.apply(this,arguments)},c=function(){function t(t){return void 0===t&&(t=!0),this.isSingleInstance=t,this.store=this.addListenerToState(JSON.parse(sessionStorage.getItem("store")||"{}"),JSON.parse(localStorage.getItem("store")||"{}")),this.singleInstance()}return t.prototype.singleInstance=function(){return window&&this.isSingleInstance?(window.$Storage||(window.$Storage=this),window.$Storage):this},t.prototype.addListenerToState=function(t,e){var o=this;return{L:new Proxy(e,{get:function(t,r){return o.checkTimeout(e),t[r]},set:function(t,e,o){return t[e]=o,localStorage.setItem("store",JSON.stringify(t)),!0}}),S:new Proxy(t,{get:function(e,r){return o.checkTimeout(t),e[r]},set:function(t,e,o){return t[e]=o,sessionStorage.setItem("store",JSON.stringify(t)),!0}})}},t.prototype.checkTimeout=function(t){return Object.keys(t).map(function(e){t[e].hasOwnProperty("delay")&&Date.now()>=t[e].overTime&&Reflect.deleteProperty(t,e)}),t},t.prototype.checkType=function(t){return Object.prototype.toString.call(t).slice(8,-1)},t.prototype.transfromDataToInstance=function(t){return{type:this.checkType(t),data:t}},t.prototype.get=function(t,e){var o=e?this.store.L:this.store.S;return"string"==typeof t?(o[t]||{}).data:t.reduce(function(t,e){var r;return a({},t,(r={},r[e]=(o[e]||{}).data,r))},{})},t.prototype.getAll=function(){return this.get(Object.keys(this.store.L).concat(Object.keys(this.store.S)))},t.prototype.set=function(t,e,o,r){var n=this,i=this.checkType(t),s=r?this.store.L:this.store.S;if("String"===i){var c=this.transfromDataToInstance(e);r&&o&&(c=a({},this.transfromDataToInstance(e),{setTime:Date.now(),delay:o,overTime:Date.now()+1e3*o})),s[t]=c}else Object.keys(t).forEach(function(e){return n.set(e,t[e])});sessionStorage.setItem("store",JSON.stringify(this.store.S)),localStorage.setItem("store",JSON.stringify(this.store.L))},t.prototype.remove=function(t,e){var o=this,r=this.checkType(t),n=e?this.store.L:this.store.S;"String"===r?Reflect.deleteProperty(n,t):t.forEach(function(t){return o.remove(t)})},t.prototype.removeAll=function(){sessionStorage.removeItem("store"),localStorage.removeItem("store"),this.store={L:{},S:{}}},t.prototype.destroyed=function(){window.$Storage=null},t}();t.__ArrayToMap=s,t.__Debounce=o,t.__MapToArray=i,t.__Once=e,t.__Throttle=r,t.__ToTree=n,t.Storage=c,Object.defineProperty(t,"__esModule",{value:!0})});
